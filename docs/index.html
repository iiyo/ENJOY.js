<!DOCTYPE html>

<html>
<head>
  <title>enjoy-core.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>enjoy-core.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* global using, define, window, module */</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    
    <span class="hljs-keyword">var</span> out = {
        hidden_properties: [],
        poly: {}, <span class="hljs-comment">/* methods for basic functions */</span>
        core: {} <span class="hljs-comment">/* basic functions */</span>
    };
    
        
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span> (<span class="hljs-params">fn, args</span>) </span>{
        
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"Argument 'fn' must be a function."</span>);
        }
        
        <span class="hljs-keyword">return</span> fn.apply(<span class="hljs-literal">undefined</span>, args);
    }
    
    out.apply = apply;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bind</span> (<span class="hljs-params">fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> args = [].slice.call(<span class="hljs-built_in">arguments</span>);
        
        args.shift();
        
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            
            <span class="hljs-keyword">var</span> allArgs = args.slice(), i;
            
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">arguments</span>.length; i += <span class="hljs-number">1</span>) {
                allArgs.push(<span class="hljs-built_in">arguments</span>[i]);
            }
            
            <span class="hljs-keyword">return</span> fn.apply(<span class="hljs-literal">undefined</span>, allArgs);
        };
    }
    
    out.bind = bind;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">call</span> (<span class="hljs-params">fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> args = [].slice.call(<span class="hljs-built_in">arguments</span>);
        
        args.shift();
        
        <span class="hljs-keyword">return</span> fn.apply(<span class="hljs-literal">undefined</span>, args);
    }
    
    out.call = call;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">partial</span> (<span class="hljs-params">fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> args = [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            
            <span class="hljs-keyword">var</span> callArgs = [].slice.call(<span class="hljs-built_in">arguments</span>);
            
            <span class="hljs-keyword">var</span> allArgs = args.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg, index</span>) </span>{
                
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> arg === <span class="hljs-string">"undefined"</span>) {
                    <span class="hljs-keyword">return</span> callArgs.shift();
                }
                
                <span class="hljs-keyword">return</span> arg;
            });
            
            <span class="hljs-keyword">if</span> (callArgs.length) {
                callArgs.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
                    allArgs.push(arg);
                });
            }
            
            <span class="hljs-keyword">return</span> apply(fn, allArgs);
        };
    }
    
    out.partial = partial;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pipe</span> (<span class="hljs-params">value</span>) </span>{
        
        each(<span class="hljs-built_in">arguments</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn, index</span>) </span>{
            <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">0</span>) {
                value = fn(value);
            }
        });
        
        <span class="hljs-keyword">return</span> value;
    }
    
    out.pipe = pipe;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">piped</span> (<span class="hljs-params"></span>) </span>{
        
        <span class="hljs-keyword">var</span> functions = [].slice.call(<span class="hljs-built_in">arguments</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
            
            <span class="hljs-keyword">var</span> args = functions.slice();
            
            args.unshift(value);
            
            <span class="hljs-keyword">return</span> apply(pipe, args);
        };
    };
    
    out.piped = piped;
        
    <span class="hljs-keyword">var</span> METHOD_PRECEDENCE_SCORE_FN = <span class="hljs-number">10</span>;
    <span class="hljs-keyword">var</span> METHOD_PRECEDENCE_SCORE_ID = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">var</span> METHOD_PRECEDENCE_SCORE_EQ = <span class="hljs-number">6</span>;
    <span class="hljs-keyword">var</span> METHOD_PRECEDENCE_SCORE_IS_A = <span class="hljs-number">4</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">method</span> (<span class="hljs-params">defaultFn</span>) </span>{
        
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span> (<span class="hljs-params"></span>) </span>{
            
            <span class="hljs-keyword">var</span> argsLength = <span class="hljs-built_in">arguments</span>.length;
            <span class="hljs-keyword">var</span> implementation = fn.$__default__;
            <span class="hljs-keyword">var</span> highestScore = <span class="hljs-number">0</span>;
            
            <span class="hljs-keyword">var</span> dispatchValues = [].map.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg, i</span>) </span>{
                
                <span class="hljs-keyword">var</span> dispatcher = fn.$__dispatchers__[i] || id;
                
                <span class="hljs-keyword">return</span> call(dispatcher, arg);
            });
            
            fn.$__implementations__.some(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
                
                <span class="hljs-keyword">var</span> currentScore = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">var</span> predicateMatches = <span class="hljs-number">0</span>;
                
                <span class="hljs-keyword">if</span> (argsLength &lt; impl.$__comparators__.length) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
                
                <span class="hljs-keyword">var</span> match = dispatchValues.every(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dispatchValue, i</span>) </span>{
                    
                    <span class="hljs-keyword">var</span> comparator = impl.$__comparators__[i];
                    <span class="hljs-keyword">var</span> comparatorIsFunction = <span class="hljs-keyword">typeof</span> comparator === <span class="hljs-string">"function"</span>;
                    <span class="hljs-keyword">var</span> argumentOrderModificator = dispatchValues.length - i;
                    
                    <span class="hljs-keyword">if</span> (i &gt;= impl.$__comparators__.length) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                    
                    <span class="hljs-keyword">if</span> (comparatorIsFunction &amp;&amp; comparator(dispatchValue)) {
                        predicateMatches += <span class="hljs-number">1</span>;
                        currentScore += METHOD_PRECEDENCE_SCORE_FN * argumentOrderModificator;
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                    
                    <span class="hljs-keyword">if</span> (identical(dispatchValue, comparator)) {
                        currentScore += METHOD_PRECEDENCE_SCORE_ID * argumentOrderModificator;
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                    
                    <span class="hljs-keyword">if</span> (equal(dispatchValue, comparator)) {
                        currentScore += METHOD_PRECEDENCE_SCORE_EQ * argumentOrderModificator;
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                    
                    <span class="hljs-keyword">if</span> (isA(dispatchValue, comparator)) {
                        currentScore += METHOD_PRECEDENCE_SCORE_IS_A * argumentOrderModificator;
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                    
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                });
                
                <span class="hljs-keyword">if</span> (match &amp;&amp; currentScore &gt; highestScore) {
                    highestScore = currentScore;
                    implementation = impl.$__implementation__;
                }
                
                <span class="hljs-keyword">if</span> (predicateMatches &gt; <span class="hljs-number">0</span> &amp;&amp; predicateMatches === dispatchValues.length) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            });
            
            <span class="hljs-keyword">return</span> apply(implementation, <span class="hljs-built_in">arguments</span>);
        }
        
        <span class="hljs-keyword">if</span> (defaultFn &amp;&amp; <span class="hljs-keyword">typeof</span> defaultFn !== <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"Argument 1 must be a function."</span>);
        }
        
        <span class="hljs-built_in">Object</span>.defineProperty(fn, <span class="hljs-string">"$__default__"</span>, {
            value: defaultFn || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"No matching implementation found for method arguments."</span>);
            },
            writable: <span class="hljs-literal">true</span>
        });
        
        <span class="hljs-built_in">Object</span>.defineProperty(fn, <span class="hljs-string">"$__dispatchers__"</span>, {
            value: [],
            writable: <span class="hljs-literal">true</span>
        });
        
        <span class="hljs-built_in">Object</span>.defineProperty(fn, <span class="hljs-string">"$__implementations__"</span>, {
            value: [],
            writable: <span class="hljs-literal">true</span>
        });
        
        <span class="hljs-built_in">Object</span>.defineProperty(fn, <span class="hljs-string">"$__type__"</span>, {value: <span class="hljs-string">"method"</span>});
        
        <span class="hljs-keyword">return</span> fn;
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"method"</span>, {value: method});
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dispatch</span> (<span class="hljs-params">method</span>) </span>{
        
        <span class="hljs-keyword">var</span> dispatchers = [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);
        
        dispatchers.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dispatcher, index</span>) </span>{
            
            <span class="hljs-keyword">var</span> dtype = <span class="hljs-keyword">typeof</span> dispatcher;
            
            <span class="hljs-keyword">if</span> (dtype !== <span class="hljs-string">"function"</span> &amp;&amp; (dtype === <span class="hljs-string">"string"</span> || dtype === <span class="hljs-string">"number"</span>)) {
                dispatcher = partial(at, <span class="hljs-literal">undefined</span>, dispatcher);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dtype !== <span class="hljs-string">"function"</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"Dispatchers must be strings, numbers or functions."</span>);
            }
            
            dispatchers[index] = dispatcher;
        });
        
        method.$__dispatchers__ = dispatchers;
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"dispatch"</span>, {value: dispatch});
        
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">specialize</span> (<span class="hljs-params"></span>) </span>{
        
        <span class="hljs-keyword">var</span> args = [].slice.call(<span class="hljs-built_in">arguments</span>);
        <span class="hljs-keyword">var</span> method = args.shift();
        <span class="hljs-keyword">var</span> implementation = args.pop();
        <span class="hljs-keyword">var</span> comparators = args.slice();
        <span class="hljs-keyword">var</span> specialization, old;
        
        method.$__implementations__.some(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
            
            <span class="hljs-keyword">var</span> matchesEvery = impl.$__comparators__.every(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">comp, i</span>) </span>{
                <span class="hljs-keyword">return</span> equal(comp, comparators[i]);
            });
            
            <span class="hljs-keyword">if</span> (matchesEvery) {
                old = impl;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        });
        
        <span class="hljs-keyword">if</span> (old) {
            old.$__implementation__ = implementation;
        }
        <span class="hljs-keyword">else</span> {
            
            specialization = {};
            
            <span class="hljs-built_in">Object</span>.defineProperty(specialization, <span class="hljs-string">"$__comparators__"</span>, {
                value: comparators
            });
            
            <span class="hljs-built_in">Object</span>.defineProperty(specialization, <span class="hljs-string">"$__implementation__"</span>, {
                value: implementation,
                writable: <span class="hljs-literal">true</span>
            });
            
            method.$__implementations__.push(specialization);
        }
    }
    
    out.hidden_properties.push(<span class="hljs-string">"$__comparators__"</span>);
    out.hidden_properties.push(<span class="hljs-string">"$__default__"</span>);
    out.hidden_properties.push(<span class="hljs-string">"$__dispatchers__"</span>);
    out.hidden_properties.push(<span class="hljs-string">"$__implementation__"</span>);
    out.hidden_properties.push(<span class="hljs-string">"$__implementations__"</span>);
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"specialize"</span>, {value: specialize});
        
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isNull</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> a === <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isUndefined</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"undefined"</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isBoolean</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"boolean"</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isNumber</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"number"</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isInteger</span> (<span class="hljs-params">n</span>) </span>{
        <span class="hljs-keyword">return</span> isNumber(n) &amp;&amp; n % <span class="hljs-number">1</span> === <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFloat</span> (<span class="hljs-params">n</span>) </span>{
        <span class="hljs-keyword">return</span> isNumber(n) &amp;&amp; n % <span class="hljs-number">1</span> !== <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isString</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"string"</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isChar</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> isString(a) &amp;&amp; a.length === <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isCollection</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> isObject(a) || isArray(a);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isObject</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"object"</span> &amp;&amp; a !== <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isArray</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.isArray(a);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFunction</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"function"</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isPrimitive</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> isNull(a) || isUndefined(a) || isNumber(a) || isString(a) || isBoolean(a);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isType</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> isObject(a) &amp;&amp; a.$__type__ === <span class="hljs-string">"type"</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isDerivable</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> isObject(a) &amp;&amp; <span class="hljs-string">"$__children__"</span> <span class="hljs-keyword">in</span> a &amp;&amp; <span class="hljs-built_in">Array</span>.isArray(a.$__children__);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isMethod</span> (<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">return</span> isObject(a) &amp;&amp; a.$__type__ === <span class="hljs-string">"method"</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">valid</span> (<span class="hljs-params">data, schema</span>) </span>{
        
        <span class="hljs-keyword">var</span> key;
        
        <span class="hljs-keyword">if</span> (!isObject(data)) {
            
            <span class="hljs-keyword">if</span> (isType(schema)) {
                <span class="hljs-keyword">return</span> isA(data, schema);
            }
            
            <span class="hljs-keyword">if</span> (isFunction(schema)) {
                <span class="hljs-keyword">return</span> schema(data);
            }
            
            <span class="hljs-keyword">return</span> identical(data, schema);
        }
        <span class="hljs-keyword">else</span> {
            
            <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> schema) {
                
                <span class="hljs-keyword">if</span> (isType(schema[key])) {
                    
                    <span class="hljs-keyword">if</span> (!isA(data[key], schema[key])) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                    
                    <span class="hljs-keyword">continue</span>;
                }
                
                <span class="hljs-keyword">if</span> (isFunction(schema[key])) {
                    
                    <span class="hljs-keyword">if</span> (!schema[key](data[key])) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                    
                    <span class="hljs-keyword">continue</span>;
                }
                
                <span class="hljs-keyword">if</span> (isObject(schema[key])) {
                    
                    <span class="hljs-keyword">if</span> (!valid(data[key], schema[key])) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                    
                    <span class="hljs-keyword">continue</span>;
                }
                
                <span class="hljs-keyword">if</span> (!equal(schema[key], data[key])) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validator</span> (<span class="hljs-params">schema</span>) </span>{
        <span class="hljs-keyword">return</span> partial(valid, <span class="hljs-literal">undefined</span>, schema);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">type</span> (<span class="hljs-params">checker</span>) </span>{
        
        <span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
        
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) {
            checker = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; };
        }
        
        <span class="hljs-keyword">if</span> (!isFunction(checker)) {
            checker = validator(checker);
        }
        
        <span class="hljs-built_in">Object</span>.defineProperty(obj, <span class="hljs-string">"$__type__"</span>, {value: <span class="hljs-string">"type"</span>});
        <span class="hljs-built_in">Object</span>.defineProperty(obj, <span class="hljs-string">"toString"</span>, {value: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">"[object Type]"</span>; }});
        <span class="hljs-built_in">Object</span>.defineProperty(obj, <span class="hljs-string">"$__checker__"</span>, {value: checker});
        makeDerivable(obj);
        
        <span class="hljs-built_in">Object</span>.freeze(obj);
        
        <span class="hljs-keyword">return</span> obj;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeDerivable</span> (<span class="hljs-params">obj</span>) </span>{
        
        <span class="hljs-keyword">if</span> (!isObject(obj) || !<span class="hljs-built_in">Object</span>.isExtensible(obj)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"Argument 'obj' is not derivable in call to make_derivable(obj)."</span>);
        }
        
        <span class="hljs-built_in">Object</span>.defineProperty(obj, <span class="hljs-string">"$__children__"</span>, {value: []});
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">derive</span> (<span class="hljs-params">child, parent</span>) </span>{
        
        <span class="hljs-keyword">if</span> (!isDerivable(child)) {
            makeDerivable(child);
        }
        
        <span class="hljs-keyword">if</span> (!isDerivable(parent)) {
            makeDerivable(parent);
        }
        
        <span class="hljs-keyword">if</span> (descendantOf(child, parent)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Child is already a descendent of this parent."</span>);
        }
        
        parent.$__children__.push(child);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">descendantOf</span> (<span class="hljs-params">a, b</span>) </span>{
        
        <span class="hljs-keyword">if</span> (!isDerivable(a)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"Parameter 'a' must be derivable."</span>);
        }
        
        <span class="hljs-keyword">if</span> (!isDerivable(b)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"Parameter 'b' must be derivable."</span>);
        }
        
        <span class="hljs-keyword">return</span> b.$__children__.some(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) </span>{
            <span class="hljs-keyword">return</span> (c === a ? <span class="hljs-literal">true</span> : c.$__children__.some(bind(descendantOf, a)));
        });
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isA</span> (<span class="hljs-params">a, t</span>) </span>{
        
        <span class="hljs-keyword">if</span> (!isDerivable(t)) {
            
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> t !== <span class="hljs-string">"function"</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-keyword">return</span> a <span class="hljs-keyword">instanceof</span> t;
        }
        
        <span class="hljs-keyword">if</span> (isDerivable(a) &amp;&amp; descendantOf(a, t)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">if</span> (!isType(t)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-keyword">if</span> (t.$__checker__(a)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">return</span> t.$__children__.some(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">child</span>) </span>{
            <span class="hljs-keyword">return</span> isA(a, child);
        });
    }
    
    <span class="hljs-keyword">var</span> t_primitive = type(isPrimitive);
    <span class="hljs-keyword">var</span> t_composite = type(isObject);
    
    <span class="hljs-keyword">var</span> t_null = type(isNull);
    <span class="hljs-keyword">var</span> t_undefined = type(isUndefined);
    
    <span class="hljs-keyword">var</span> t_boolean = type(isBoolean);
    
    <span class="hljs-keyword">var</span> t_char = type(isChar);
    <span class="hljs-keyword">var</span> t_string = type(isString);
    
    <span class="hljs-keyword">var</span> t_number = type(isNumber);
    <span class="hljs-keyword">var</span> t_float = type(isFloat);
    <span class="hljs-keyword">var</span> t_integer = type(isInteger);
    
    <span class="hljs-keyword">var</span> t_object = type(isObject);
    <span class="hljs-keyword">var</span> t_array = type(isArray);
    
    <span class="hljs-keyword">var</span> t_function = type(isFunction);
    
    derive(t_null, t_primitive);
    derive(t_undefined, t_primitive);
    derive(t_boolean, t_primitive);
    derive(t_string, t_primitive);
    
    derive(t_char, t_string);
    
    derive(t_float, t_number);
    derive(t_integer, t_number);
    
    derive(t_object, t_composite);
    derive(t_array, t_object);
    derive(t_function, t_object);
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"type"</span>, {value: type});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"derive"</span>, {value: derive});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"makeDerivable"</span>, {value: makeDerivable});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"valid"</span>, {value: valid});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"validator"</span>, {value: validator});
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isA"</span>, {value: isA});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isNull"</span>, {value: isNull});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isUndefined"</span>, {value: isUndefined});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isBoolean"</span>, {value: isBoolean});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isNumber"</span>, {value: isNumber});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isInteger"</span>, {value: isInteger});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isFloat"</span>, {value: isFloat});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isString"</span>, {value: isString});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isChar"</span>, {value: isChar});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isColllection"</span>, {value: isCollection});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isObject"</span>, {value: isObject});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isArray"</span>, {value: isArray});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isFunction"</span>, {value: isFunction});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isPrimitive"</span>, {value: isPrimitive});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isType"</span>, {value: isType});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isDerivable"</span>, {value: isDerivable});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isMethod"</span>, {value: isMethod});
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_primitive"</span>, {value: t_primitive});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_composite"</span>, {value: t_composite});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_null"</span>, {value: t_null});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_undefined"</span>, {value: t_undefined});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_boolean"</span>, {value: t_boolean});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_char"</span>, {value: t_char});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_string"</span>, {value: t_string});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_number"</span>, {value: t_number});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_float"</span>, {value: t_float});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_integer"</span>, {value: t_integer});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_object"</span>, {value: t_object});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_array"</span>, {value: t_array});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_function"</span>, {value: t_function});
    
    out.hidden_properties.push(<span class="hljs-string">"$__type__"</span>);
    out.hidden_properties.push(<span class="hljs-string">"$__children__"</span>);
    out.hidden_properties.push(<span class="hljs-string">"$__checker__"</span>);
        
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contains</span> (<span class="hljs-params">collection, item</span>) </span>{
        <span class="hljs-keyword">return</span> some(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">currentItem</span>) </span>{
            <span class="hljs-keyword">return</span> item === currentItem;
        }) || <span class="hljs-literal">false</span>;
    }
    
    out.contains = contains;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Turns an array of objects into an object where the keys are the
values of a property of the objects contained wihtin the original array.</p>
<p>Example:</p>
<pre><code>[{name: <span class="hljs-string">"foo"</span>},{name: <span class="hljs-string">"bar"</span>}] =&gt; {foo: {name: <span class="hljs-string">"foo"</span>}, bar: {name: <span class="hljs-string">"bar"</span>}}
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">expose</span> (<span class="hljs-params">collection, key</span>) </span>{
        
        <span class="hljs-keyword">var</span> result = {};
        
        each(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{
            result[item[key]] = item;
        });
        
        <span class="hljs-keyword">return</span> result;
    }
    
    out.expose = expose;
    
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span> (<span class="hljs-params">collection, fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> items = [];
        
        each(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, key</span>) </span>{
            <span class="hljs-keyword">if</span> (fn(item, key, collection)) {
                items.push(item);
            }
        });
        
        <span class="hljs-keyword">return</span> items;
    }
    
    out.filter = filter;
        
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find</span> (<span class="hljs-params">collection, fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> value;
        
        some(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, key</span>) </span>{
            
            <span class="hljs-keyword">if</span> (fn(item, key, collection)) {
                value = item;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        });
        
        <span class="hljs-keyword">return</span> value;
    }
    
    out.find = find;
    
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">has</span> (<span class="hljs-params">collection, key</span>) </span>{
        <span class="hljs-keyword">return</span> some(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, currentKey</span>) </span>{
            <span class="hljs-keyword">return</span> key === currentKey;
        }) || <span class="hljs-literal">false</span>;
    }
    
    out.has = has;
    
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">head</span> (<span class="hljs-params">iterable</span>) </span>{
        <span class="hljs-keyword">return</span> iterable[<span class="hljs-number">0</span>];
    }
    
    out.head = head;
    
    
    <span class="hljs-keyword">var</span> keys = method(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">collection</span>) </span>{
        
        <span class="hljs-keyword">var</span> result = [];
        
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(collection)) {
            collection.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, key</span>) </span>{
                result.push(key);
            });
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> collection === <span class="hljs-string">"object"</span>) {
            <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> collection) {
                result.push(key);
            }
        }
        
        <span class="hljs-keyword">return</span> result;
    });
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"keys"</span>, {value: keys});
    
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span> (<span class="hljs-params">collection, fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> items = [];
        
        each(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, key</span>) </span>{
            items.push(fn(item, key, collection));
        });
        
        <span class="hljs-keyword">return</span> items;
    }
    
    out.map = map;
    
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pluck</span> (<span class="hljs-params">collection, key</span>) </span>{
        
        <span class="hljs-keyword">var</span> result = [];
        
        map(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{
            <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> item) {
                result.push(item[key]);
            }
        });
        
        <span class="hljs-keyword">return</span> result;
    }
    
    out.pluck = pluck</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Turns an object into an array by putting its keys into the objects
contained within the array.</p>
<p>Example:</p>
<pre><code>{foo: {}, bar: {}} =&gt; [{name: <span class="hljs-string">"foo"</span>},{name: <span class="hljs-string">"bar"</span>}]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">privatize</span> (<span class="hljs-params">collection, key</span>) </span>{
        
        <span class="hljs-keyword">var</span> result = [];
        
        each(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, currentKey</span>) </span>{
            
            item[key] = currentKey;
            
            result.push(item);
        });
        
        <span class="hljs-keyword">return</span> result;
    }
    
    out.privatize = privatize;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3 id="function-reduce-collection-fn-value-">Function reduce(collection, fn[, value])</h3>
<pre><code>collection -&gt; (any -&gt; any -&gt; string|number -&gt; collection) -&gt; any -&gt; any
</code></pre><p>Reduces a collection to a single value by applying every item in the collection
along with the item’s key, the previously reduced value (or the start value)
and the collection itself to a reducer function <code>fn</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reduce</span> (<span class="hljs-params">collection, fn, value</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>If the collection is an array, the native .reduce() method is used for performance:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(collection)) {
            <span class="hljs-keyword">return</span> collection.reduce(fn, value);
        }
        
        each(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, key</span>) </span>{
            value = fn(value, item, key, collection);
        });
        
        <span class="hljs-keyword">return</span> value;
    }
    
    out.reduce = reduce;
    
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tail</span> (<span class="hljs-params">iterable</span>) </span>{
        <span class="hljs-keyword">return</span> iterable.slice(<span class="hljs-number">1</span>);
    }
    
    out.tail = tail;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3 id="function-at-collection-key-">Function at(collection, key)</h3>
<pre><code>collection -&gt; string | number -&gt; any
</code></pre><p>Returns a collection’s value at <code>key</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">var</span> at = method(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">collection, key</span>) </span>{
        <span class="hljs-keyword">return</span> collection[key];
    });
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"at"</span>, {value: at});</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h3 id="function-picker-key-">Function picker(key)</h3>
<pre><code>string | number -&gt; (collection -&gt; any)
</code></pre><p>Binds <code>at</code> to a <code>key</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">picker</span> (<span class="hljs-params">key</span>) </span>{
        <span class="hljs-keyword">return</span> partial(at, <span class="hljs-literal">undefined</span>, key);
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"picker"</span>, {value: picker});</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h3 id="function-getter-collection-">Function getter(collection)</h3>
<pre><code>collection -&gt; (string | number -&gt; any)
</code></pre><p>Binds <code>at</code> to a <code>collection</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getter</span> (<span class="hljs-params">collection</span>) </span>{
        <span class="hljs-keyword">return</span> bind(at, collection);
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"getter"</span>, {value: getter});</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3 id="function-put-collection-key-value-">Function put(collection, key, value)</h3>
<pre><code>collection -&gt; string -&gt; any -&gt; <span class="hljs-literal">undefined</span>
</code></pre><p>Puts a <code>value</code> into a collection at <code>key</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">var</span> put = method(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">collection, key, value</span>) </span>{
        collection[key] = value;
        <span class="hljs-keyword">return</span> collection;
    });
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"put"</span>, {value: put});</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3 id="function-putter-key-">Function putter(key)</h3>
<pre><code>string -&gt; (collection -&gt; value -&gt; <span class="hljs-literal">undefined</span>)
</code></pre><p>Binds <code>put</code> to a key.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">putter</span> (<span class="hljs-params">key</span>) </span>{
        <span class="hljs-keyword">return</span> partial(put, <span class="hljs-literal">undefined</span>, key, <span class="hljs-literal">undefined</span>);
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"putter"</span>, {value: putter});</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h3 id="function-setter-collection-">Function setter(collection)</h3>
<pre><code>collection -&gt; (string -&gt; value -&gt; <span class="hljs-literal">undefined</span>)
</code></pre><p>Binds <code>put</code> to a collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setter</span> (<span class="hljs-params">collection</span>) </span>{
        <span class="hljs-keyword">return</span> bind(put, collection);
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"setter"</span>, {value: setter});</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h3 id="function-values-collection-">Function values(collection)</h3>
<pre><code>collection -&gt; [any]
</code></pre><p>Extracts all values from a collection such as <code>array</code> or <code>object</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">values</span> (<span class="hljs-params">collection</span>) </span>{
        <span class="hljs-keyword">return</span> map(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{
            <span class="hljs-keyword">return</span> item;
        });
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"values"</span>, {value: values});
        
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">identical</span> (<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a === b;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">equal</span> (<span class="hljs-params">a, b</span>) </span>{
        
        <span class="hljs-keyword">var</span> key, index, isArray, isArgumentsObject;
        
        <span class="hljs-keyword">if</span> (a === b) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a !== <span class="hljs-keyword">typeof</span> b) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-keyword">if</span> (a === <span class="hljs-literal">null</span> &amp;&amp; b !== <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        isArray = <span class="hljs-built_in">Array</span>.isArray(a);
        isArgumentsObject = <span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"object"</span> &amp;&amp;
            <span class="hljs-built_in">Object</span>.prototype.toString.call(a) === <span class="hljs-string">"[object Arguments]"</span>;
        
        <span class="hljs-keyword">if</span> (isArray || isArgumentsObject) {
            
            <span class="hljs-keyword">if</span> (isArray &amp;&amp; !<span class="hljs-built_in">Array</span>.isArray(b)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-keyword">if</span> (isArgumentsObject &amp;&amp; b.toString() !== <span class="hljs-string">"[object Arguments]"</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-keyword">if</span> (a.length !== b.length) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-keyword">for</span> (index = <span class="hljs-number">0</span>; index &lt; a.length; index += <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">if</span> (!equal(a[index], b[index])) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"object"</span>) {
            
            <span class="hljs-keyword">if</span> (a.prototype !== b.prototype) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> a) {
                <span class="hljs-keyword">if</span> (!equal(a[key], b[key])) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
            
            <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> b) {
                <span class="hljs-keyword">if</span> (!equal(a[key], b[key])) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
            
            <span class="hljs-keyword">if</span> (some(out.hiddenProperties, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{ <span class="hljs-keyword">return</span> a[key] !== b[key]; })) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    out.equal = equal;
    
    
    <span class="hljs-keyword">var</span> each = method(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">collection, fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> index, length, ids = keys(collection);
        
        <span class="hljs-keyword">for</span> (index = <span class="hljs-number">0</span>, length = ids.length; index &lt; length; index += <span class="hljs-number">1</span>) {
            fn(at(collection, ids[index]), ids[index], collection);
        }
    });
    
    specialize(each, isArray, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">collection, fn</span>) </span>{
        <span class="hljs-keyword">return</span> collection.forEach(fn);
    });
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"each"</span>, {value: each});
    
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">every</span> (<span class="hljs-params">collection, fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> result = <span class="hljs-literal">true</span>;
        
        some(collection, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, key</span>) </span>{
            
            <span class="hljs-keyword">if</span> (!fn(item, key, collection)) {
                result = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        });
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"every"</span>, {value: every});
    
    
    <span class="hljs-keyword">var</span> some = method(someObject);
    
    specialize(some, <span class="hljs-built_in">Array</span>.isArray, someArray);
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"some"</span>, {value: some});
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">someArray</span> (<span class="hljs-params">collection, fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> index, length, value;
        
        <span class="hljs-keyword">for</span> (index = <span class="hljs-number">0</span>, length = collection.length; index &lt; length; index += <span class="hljs-number">1</span>) {
            
            value = fn(collection[index], index, collection);
            
            <span class="hljs-keyword">if</span> (value) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">someObject</span> (<span class="hljs-params">collection, fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> ids = keys(collection), value, i, length, key;
        
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, length = ids.length; i &lt; length; i += <span class="hljs-number">1</span>) {
            
            key = ids[i];
            value = fn(at(collection, key), key, collection);
            
            <span class="hljs-keyword">if</span> (value) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">perform</span> (<span class="hljs-params">fn, times</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; times; i += <span class="hljs-number">1</span>) {
            fn();
        }
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"perform"</span>, {value: perform});
    
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loop</span> (<span class="hljs-params">fn</span>) </span>{
        <span class="hljs-keyword">while</span> (fn()) {
            <span class="hljs-comment">/* do nothing */</span>
        }
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"loop"</span>, {value: loop});</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>We use a bit-partitioned vector trie to implement efficient persistent vectors.
This implementation is pretty much the same as the one by Rich Hickey in the
Java implementation of Clojure.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
    <span class="hljs-keyword">var</span> V_BITS = <span class="hljs-number">5</span>;
    <span class="hljs-keyword">var</span> V_WIDTH = <span class="hljs-number">1</span> &lt;&lt; V_BITS;
    <span class="hljs-keyword">var</span> V_MASK = V_WIDTH - <span class="hljs-number">1</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v</span> (<span class="hljs-params"></span>) </span>{
        
        <span class="hljs-keyword">var</span> items = [].slice.call(<span class="hljs-built_in">arguments</span>);
        <span class="hljs-keyword">var</span> root = v_node();
        <span class="hljs-keyword">var</span> vec = v_create(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, root, root);
        
        items.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{
            vec = v_append(vec, item);
        });
        
        <span class="hljs-keyword">return</span> vec;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isVector</span> (<span class="hljs-params">thing</span>) </span>{
        <span class="hljs-keyword">return</span> isObject(thing) &amp;&amp; thing.$__type__ === <span class="hljs-string">"vector"</span>;
    }
    
    <span class="hljs-keyword">var</span> t_vector = type(isVector);
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v_at</span> (<span class="hljs-params">vec, i</span>) </span>{
        <span class="hljs-keyword">return</span> v_nodeAt(vec, i).content[i &amp; V_MASK];
    }
    
    specialize(at, t_vector, v_at);
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v_nodeAt</span> (<span class="hljs-params">vec, i</span>) </span>{
        
        <span class="hljs-keyword">var</span> level;
        <span class="hljs-keyword">var</span> node = vec.$__root__;
        <span class="hljs-keyword">var</span> shift = vec.$__shift__;
        
        <span class="hljs-keyword">if</span> (i &gt;= <span class="hljs-number">0</span> &amp;&amp; i &lt; vec.$__count__) {
            
            <span class="hljs-keyword">if</span> (i &gt;= v_tailOff(vec)) {
                <span class="hljs-keyword">return</span> vec.$__tail__;
            }
            
            <span class="hljs-keyword">for</span> (level = shift; level &gt; <span class="hljs-number">0</span>; level -= V_BITS) {
                node = node.content[(i &gt;&gt;&gt; level) &amp; V_MASK];
            }
            
            <span class="hljs-keyword">return</span> node.content;
        }
        
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RangeError</span>(<span class="hljs-string">"Vector index out of bounds:"</span>, i);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v_tailOff</span> (<span class="hljs-params">vec</span>) </span>{
        
        <span class="hljs-keyword">if</span> (vec.$__count__ &lt; V_WIDTH) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-keyword">return</span> ((vec.$__count__ - <span class="hljs-number">1</span>) &gt;&gt;&gt; V_BITS) &lt;&lt; V_BITS;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v_create</span> (<span class="hljs-params">count, shift, root, tail</span>) </span>{
        
        <span class="hljs-keyword">var</span> vec = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
        
        <span class="hljs-built_in">Object</span>.defineProperty(vec, <span class="hljs-string">"$__type__"</span>, {value: <span class="hljs-string">"vector"</span>});
        <span class="hljs-built_in">Object</span>.defineProperty(vec, <span class="hljs-string">"$__count__"</span>, {value: count});
        <span class="hljs-built_in">Object</span>.defineProperty(vec, <span class="hljs-string">"$__shift__"</span>, {value: shift});
        <span class="hljs-built_in">Object</span>.defineProperty(vec, <span class="hljs-string">"$__root__"</span>, {value: root});
        <span class="hljs-built_in">Object</span>.defineProperty(vec, <span class="hljs-string">"$__tail__"</span>, {value: tail});
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.freeze(vec);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v_append</span> (<span class="hljs-params">vec, value</span>) </span>{
        
        <span class="hljs-keyword">var</span> tail = vec.$__tail__;
        <span class="hljs-keyword">var</span> root = vec.$__root__;
        <span class="hljs-keyword">var</span> count = vec.$__count__;
        <span class="hljs-keyword">var</span> shift = vec.$__shift__;
        <span class="hljs-keyword">var</span> newTail, newShift, newRoot, expansion;
        
        <span class="hljs-keyword">if</span> (tail.content.length &lt; V_WIDTH) {
            newTail = v_node(tail.content);
            newTail.content.push(value);
            <span class="hljs-keyword">return</span> v_create(count + <span class="hljs-number">1</span>, shift, root, newTail);
        }
        
        expansion = {};
        newTail = v_node([value]);
        newShift = shift;
        newRoot = v_pushTail(shift - V_BITS, root, tail, expansion);
        
        <span class="hljs-keyword">if</span> (expansion.val !== <span class="hljs-literal">null</span>) {
            newRoot = v_node([newRoot, expansion.val]);
            newShift += V_BITS;
        }
        
        <span class="hljs-keyword">return</span> v_create(count + <span class="hljs-number">1</span>, newShift, newRoot, newTail);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v_pushTail</span> (<span class="hljs-params">level, root, tail, expansion</span>) </span>{
        
        <span class="hljs-keyword">var</span> new_child, ret;
        
        <span class="hljs-keyword">if</span> (level === <span class="hljs-number">0</span>) {
            new_child = tail;
        }
        <span class="hljs-keyword">else</span> {
            
            new_child = v_pushTail(level - V_BITS, v_node(), tail, expansion);
            
            <span class="hljs-keyword">if</span> (expansion.val === <span class="hljs-literal">null</span>) {
                ret = v_node(root.content);
                ret.push(new_child);
                <span class="hljs-keyword">return</span> ret;
            }
            <span class="hljs-keyword">else</span> {
                new_child = expansion.val;
            }
        }
        
        <span class="hljs-keyword">if</span> (root.content.length == V_WIDTH) {
            expansion.val = v_node([new_child]);
            <span class="hljs-keyword">return</span> root;
        }
        
        expansion.val = <span class="hljs-literal">null</span>;
        ret = v_node(root.content);
        
        ret.content.push(new_child);
        
        <span class="hljs-keyword">return</span> ret;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">v_node</span> (<span class="hljs-params">content</span>) </span>{
        
        <span class="hljs-keyword">var</span> node = {
            content: content ? content.slice() : []
        };
        
        <span class="hljs-built_in">Object</span>.defineProperty(node, <span class="hljs-string">"$__type__"</span>, {value: <span class="hljs-string">"v_node"</span>});
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.freeze(node);
    }
    
    <span class="hljs-built_in">Object</span>.freeze(v);
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"V_BITS"</span>, {value: V_BITS});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"V_WIDTH"</span>, {value: V_WIDTH});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"V_MASK"</span>, {value: V_MASK});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"v"</span>, {value: v});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"isVector"</span>, {value: isVector});
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"t_vector"</span>, {value: t_vector});
        
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">id</span> (<span class="hljs-params">thing</span>) </span>{
        <span class="hljs-keyword">return</span> thing;
    }
    
    out.id = id;
    
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">measure</span> (<span class="hljs-params">fn</span>) </span>{
        
        <span class="hljs-keyword">var</span> time = <span class="hljs-built_in">Date</span>.now();
        
        fn();
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Date</span>.now() - time;
    }
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"measure"</span>, {value: measure});
    
    
    <span class="hljs-keyword">var</span> print = <span class="hljs-built_in">console</span>.log.bind(<span class="hljs-built_in">console</span>);
    
    <span class="hljs-built_in">Object</span>.defineProperty(out, <span class="hljs-string">"print"</span>, {value: print});
    

    
    (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        
        <span class="hljs-keyword">var</span> scripts;
        
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> using === <span class="hljs-string">"function"</span>) {
            
            scripts = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">"script"</span>);
            using.modules.enjoy = scripts[scripts.length - <span class="hljs-number">1</span>].src;
            
            using().define(<span class="hljs-string">"enjoy"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> out;
            });
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> === <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-built_in">module</span> !== <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">module</span>.exports = out;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">"function"</span>) {
            define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> out;
            });
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> === <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-built_in">window</span> !== <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">window</span>.enjoy = out;
        }
        
    }());
}());</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
